"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[874],{8779:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>t});const r=JSON.parse('{"id":"seq-db/public-api","title":"Public API","description":"Introduction","source":"@site/i18n/ru/docusaurus-plugin-content-docs/current/seq-db/10-public-api.md","sourceDirName":"seq-db","slug":"/seq-db/public-api","permalink":"/seq-db-docs/ru/seq-db/public-api","draft":false,"unlisted":false,"editUrl":"https://github.com/ozontech/seq-db/tree/main/website/docs/docs/seq-db/10-public-api.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{},"sidebar":"docs","previous":{"title":"\u0423\u0441\u0442\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u043d\u0435\u043f\u043e\u043b\u0430\u0434\u043e\u043a","permalink":"/seq-db-docs/ru/seq-db/troubleshooting"},"next":{"title":"benchmarks","permalink":"/seq-db-docs/ru/seq-db/benchmarks"}}');var c=s(4848),l=s(8453);const i={},d="Public API",a={},t=[{value:"Introduction",id:"introduction",level:2},{value:"Bulk HTTP API",id:"bulk-http-api",level:2},{value:"<code>/</code>",id:"",level:3},{value:"Example request:",id:"example-request",level:4},{value:"Example successful response:",id:"example-successful-response",level:4},{value:"<code>/_bulk</code>",id:"_bulk",level:3},{value:"Example request:",id:"example-request-1",level:4},{value:"Example successful response:",id:"example-successful-response-1",level:4},{value:"Example rate-limited response",id:"example-rate-limited-response",level:4},{value:"Example error response",id:"example-error-response",level:4},{value:"Search gRPC API",id:"search-grpc-api",level:2},{value:"<code>/Search</code>",id:"search",level:3},{value:"<code>/GetAggregation</code>",id:"getaggregation",level:3},{value:"\u041f\u0440\u0438\u043c\u0435\u0440\u044b \u0430\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u0439",id:"\u043f\u0440\u0438\u043c\u0435\u0440\u044b-\u0430\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u0439",level:4},{value:"\u0412\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 SUM, AVG, MIN, MAX",id:"\u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435-sum-avg-min-max",level:5},{value:"\u0412\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 SUM, AVG, MIN, MAX c group_by",id:"\u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435-sum-avg-min-max-c-group_by",level:5},{value:"QUANTILE",id:"quantile",level:5},{value:"UNIQUE, COUNT",id:"unique-count",level:5},{value:"<code>/GetHistogram</code>",id:"gethistogram",level:3},{value:"<code>/ComplexSearch</code>",id:"complexsearch",level:3},{value:"<code>/Fetch</code>",id:"fetch",level:3},{value:"<code>/Mapping</code>",id:"mapping",level:4},{value:"<code>/Status</code>",id:"status",level:4},{value:"<code>/Export</code>",id:"export",level:4}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"public-api",children:"Public API"})}),"\n",(0,c.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,c.jsx)(n.p,{children:"seq-db consists of 2 components - proxy and store:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["seq-db proxy and seq-db store communicate via\n",(0,c.jsx)(n.em,{children:"internal"})," ",(0,c.jsx)(n.a,{href:"https://github.com/ozontech/seq-db/tree/main/api/storeapi",children:"seq-db store gRPC API"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Querying logs is done via ",(0,c.jsx)(n.a,{href:"https://github.com/ozontech/seq-db/tree/main/api/seqproxyapi/v1",children:"seq-db proxy gRPC API"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Ingesting logs is done via ",(0,c.jsx)(n.a,{href:"https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html",children:"Elasticsearch compatible HTTP API"})]}),"\n",(0,c.jsxs)(n.li,{children:["For debugging purposes, seq-db proxy has ",(0,c.jsx)(n.code,{children:"HTTP API"})," similar to ",(0,c.jsx)(n.code,{children:"gRPC API"})]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["This document describes ",(0,c.jsx)(n.code,{children:"seq-db ingestion API"})," and ",(0,c.jsx)(n.code,{children:"seq-db search API"})]}),"\n",(0,c.jsx)(n.h2,{id:"bulk-http-api",children:"Bulk HTTP API"}),"\n",(0,c.jsx)(n.p,{children:"seq-db is compatible with Elasticsearch bulk API"}),"\n",(0,c.jsx)(n.h3,{id:"",children:(0,c.jsx)(n.code,{children:"/"})}),"\n",(0,c.jsx)(n.p,{children:"Returns a hardcoded ES response that specifies the Elasticsearch version used. This feature allows the usage of seq-db\nas an Elasticsearch output for logstash, filebeat, and other log shippers."}),"\n",(0,c.jsx)(n.h4,{id:"example-request",children:"Example request:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"curl -X GET http://localhost:9002/\n"})}),"\n",(0,c.jsx)(n.h4,{id:"example-successful-response",children:"Example successful response:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "cluster_name": "seq-db",\n  "version": {\n    "number": "8.9.0"\n  }\n}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"_bulk",children:(0,c.jsx)(n.code,{children:"/_bulk"})}),"\n",(0,c.jsx)(n.p,{children:"Receives body, parses it to docs and metas and writes to stores via internal API."}),"\n",(0,c.jsx)(n.h4,{id:"example-request-1",children:"Example request:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:9002/_bulk -d \'\n{"index":""}\n{"k8s_pod":"seq-proxy", "request_time": "5", "time": "2024-12-23T18:00:36.357Z"}\n{"index":""}\n{"k8s_pod":"seq-proxy", "request_time": "6"}\n{"index":""}\n{"k8s_pod":"seq-proxy", "request_time": "7"}\n{"index":""}\n{"k8s_pod":"seq-proxy", "request_time": "8"}\n{"index":""}\n{"k8s_pod":"seq-proxy", "request_time": "9"}\n{"index":""}\n{"k8s_pod":"seq-db", "request_time": "10"}\n{"index":""}\n{"k8s_pod":"seq-db", "request_time": "11"}\n{"index":""}\n{"k8s_pod":"seq-db", "request_time": "12"}\n{"index":""}\n{"k8s_pod":"seq-db", "request_time": "13"}\n{"index":""}\n{"k8s_pod":"seq-db", "request_time": "14"}\n\'\n'})}),"\n",(0,c.jsx)(n.h4,{id:"example-successful-response-1",children:"Example successful response:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "took": 11,\n  "errors": false,\n  "items": [\n    { "create": { "status": 201 } },\n    { "create": { "status": 201 } },\n    { "create": { "status": 201 } },\n    { "create": { "status": 201 } },\n    { "create": { "status": 201 } },\n    { "create": { "status": 201 } },\n    { "create": { "status": 201 } },\n    { "create": { "status": 201 } },\n    { "create": { "status": 201 } },\n    { "create": { "status": 201 } }\n  ]\n}\n'})}),"\n",(0,c.jsxs)(n.p,{children:["One can notice that ",(0,c.jsx)(n.code,{children:"index"})," field is left empty. seq-db ignores data passed in this field, since it uses mapping\nfor field indexing. You can find more information about mapping in ",(0,c.jsx)(n.a,{href:"/seq-db-docs/ru/seq-db/index-types",children:"relevant document"})]}),"\n",(0,c.jsx)(n.h4,{id:"example-rate-limited-response",children:"Example rate-limited response"}),"\n",(0,c.jsxs)(n.p,{children:["There should not be more than ",(0,c.jsx)(n.code,{children:"consts.IngestorMaxInflightBulks"})," requests at the same time (32 by default), otherwise\nrequest is rate-limited and seq-db will response with ",(0,c.jsx)(n.a,{href:"https://developer.mozilla.org/ru/docs/Web/HTTP/Reference/Status/429",children:(0,c.jsx)(n.code,{children:"429"})})," status code."]}),"\n",(0,c.jsx)(n.h4,{id:"example-error-response",children:"Example error response"}),"\n",(0,c.jsxs)(n.p,{children:["In case of error seq-db returns ",(0,c.jsx)(n.code,{children:"500"})," status code and the error message.\nE.g. if we try to ingest corrupted json"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'curl -v -X POST http://localhost:9002/_bulk -d \'\n{"index":""}\n{"k8s_pod":"seq-proxy", "request_time": "123}\n\'\n'})}),"\n",(0,c.jsx)(n.p,{children:"We get"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'processing doc: unexpected end of string near `", "request_time": "123`\n                                                  ^\n'})}),"\n",(0,c.jsx)(n.h2,{id:"search-grpc-api",children:"Search gRPC API"}),"\n",(0,c.jsx)(n.h3,{id:"search",children:(0,c.jsx)(n.code,{children:"/Search"})}),"\n",(0,c.jsx)(n.p,{children:"Document search method by request. Takes in query in seq-ql format and returns list of satisfying documents."}),"\n",(0,c.jsx)(n.p,{children:"Example request:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'grpcurl -plaintext -d \'\n{\n  "query": {\n    "from": "2020-01-01T00:00:00Z",\n    "to": "2030-01-01T00:00:00Z",\n    "query": "k8s_pod:seq-db"\n  },\n  "size": 2,\n  "with_total": true\n}\' localhost:9004 seqproxyapi.v1.SeqProxyApi/Search\n'})}),"\n",(0,c.jsx)(n.p,{children:"Example successful response:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "total": "5",\n  "docs": [\n    {\n      "id": "0593adf493010000-d901eee224290dc6",\n      "data": "eyJrOHNfcG9kIjoic2VxLWRiIiwgInJlcXVlc3RfdGltZSI6ICIxMyJ9",\n      "time": "2024-12-23T18:00:36.357Z"\n    },\n    {\n      "id": "0593adf493010000-d9013865e424dba1",\n      "data": "eyJrOHNfcG9kIjoic2VxLWRiIiwgInJlcXVlc3RfdGltZSI6ICIxMSJ9",\n      "time": "2024-12-23T18:00:36.357Z"\n    }\n  ],\n  "error": {\n    "code": "ERROR_CODE_NO"\n  }\n}\n'})}),"\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"data"})," field contains original document in base64 format. If we try to decode it"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"echo 'eyJrOHNfcG9kIjoic2VxLWRiIiwgInJlcXVlc3RfdGltZSI6ICIxMyJ9' | base64 -d | jq\n"})}),"\n",(0,c.jsx)(n.p,{children:"we get"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "k8s_pod": "seq-db",\n  "request_time": "13"\n}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"getaggregation",children:(0,c.jsx)(n.code,{children:"/GetAggregation"})}),"\n",(0,c.jsx)(n.p,{children:"\u0410\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u0438 \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u044e\u0442 \u0432\u044b\u0447\u0438\u0441\u043b\u044f\u0442\u044c \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f (\u0441\u0443\u043c\u043c\u0430, \u0441\u0440\u0435\u0434\u043d\u0435\u0435, \u043c\u0430\u043a\u0441\u0438\u043c\u0443\u043c, \u043c\u0438\u043d\u0438\u043c\u0443\u043c, \u043a\u0432\u0430\u043d\u0442\u0438\u043b\u044c, \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c, \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e) \u043f\u043e\n\u043f\u043e\u043b\u044f\u043c \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432, \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u043c \u0437\u0430\u043f\u0440\u043e\u0441\u0443."}),"\n",(0,c.jsx)(n.p,{children:"\u0410\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u0438 \u043c\u043e\u0436\u043d\u043e \u0432\u044b\u0437\u044b\u0432\u0430\u0442\u044c \u0434\u0432\u0443\u043c\u044f \u0441\u043f\u043e\u0441\u043e\u0431\u0430\u043c\u0438:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\u0447\u0435\u0440\u0435\u0437 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0439 gRPC \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a: ",(0,c.jsx)(n.a,{href:"#getaggregation",children:(0,c.jsx)(n.code,{children:"GetAggregation"})})]}),"\n",(0,c.jsxs)(n.li,{children:["\u0432\u043c\u0435\u0441\u0442\u0435 \u0441 \u043f\u043e\u0438\u0441\u043a\u043e\u043c \u0438 \u0433\u0438\u0441\u0442\u043e\u0433\u0440\u0430\u043c\u043c\u0430\u043c\u0438: ",(0,c.jsx)(n.a,{href:"#complexsearch",children:(0,c.jsx)(n.code,{children:"ComplexSearch"})})]}),"\n"]}),"\n",(0,c.jsxs)(n.blockquote,{children:["\n",(0,c.jsxs)(n.p,{children:["\u0412 \u043f\u0440\u0438\u043c\u0435\u0440\u0430\u0445 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f API ",(0,c.jsx)(n.code,{children:"GetAggregation"}),",\n\u043a\u043e\u0442\u043e\u0440\u0430\u044f \u043f\u043e \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0435 \u0437\u0430\u043f\u0440\u043e\u0441\u0430 \u0438 \u043e\u0442\u0432\u0435\u0442\u0430 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0435\u0442 \u0441 ",(0,c.jsx)(n.code,{children:"ComplexSearch"}),"."]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043c\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 \u0430\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u0438:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"AGG_FUNC_SUM"})," \u2014 \u0441\u0443\u043c\u043c\u0430 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u043f\u043e\u043b\u044f"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"AGG_FUNC_AVG"})," \u2014 \u0441\u0440\u0435\u0434\u043d\u0435\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"AGG_FUNC_MIN"})," \u2014 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"AGG_FUNC_MAX"})," \u2014 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043b\u044f"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"AGG_FUNC_QUANTILE"})," \u2014 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 \u043a\u0432\u0430\u043d\u0442\u0438\u043b\u0435\u0439 \u0434\u043b\u044f \u043f\u043e\u043b\u044f"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"AGG_FUNC_UNIQUE"})," \u2014 \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0445 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u043f\u043e\u043b\u044f"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"AGG_FUNC_COUNT"})," \u2014 \u043f\u043e\u0434\u0441\u0447\u0451\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0430 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u043f\u043e \u0433\u0440\u0443\u043f\u043f\u0435"]}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"\u043f\u0440\u0438\u043c\u0435\u0440\u044b-\u0430\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u0439",children:"\u041f\u0440\u0438\u043c\u0435\u0440\u044b \u0430\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u0439"}),"\n",(0,c.jsx)(n.p,{children:"\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u044b:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",metastring:"lines",children:'{"service": "svc1", "latency": 100}\n{"service": "svc1", "latency": 300}\n{"service": "svc2", "latency": 400}\n{"service": "svc2", "latency": 200}\n{"service": "svc3", "latency": 500}\n'})}),"\n",(0,c.jsx)(n.h5,{id:"\u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435-sum-avg-min-max",children:"\u0412\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 SUM, AVG, MIN, MAX"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u0417\u0430\u043f\u0440\u043e\u0441:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:'{\n  "query": {\n    "from": "2000-01-01T00:00:00Z",\n    "to": "2077-01-01T00:00:00Z",\n    "query": "*"\n  },\n  "aggs": [\n    {\n      "field": "latency",\n      "func": "AGG_FUNC_SUM"\n    },\n    {\n      "field": "latency",\n      "func": "AGG_FUNC_AVG"\n    },\n    {\n      "field": "latency",\n      "func": "AGG_FUNC_MIN"\n    },\n    {\n      "field": "latency",\n      "func": "AGG_FUNC_MAX"\n    }\n  ]\n} | grpcurl -plaintext -d @ localhost:9004 seqproxyapi.v1.SeqProxyApi/GetAggregation\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u041e\u0442\u0432\u0435\u0442:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "aggs": [\n    {\n      "buckets": [\n        {"value": 1500}\n      ]\n    },\n    {\n      "buckets": [\n        {"value": 300}\n      ]\n    },\n    {\n      "buckets": [\n        {"value": 100}\n      ]\n    },\n    {\n      "buckets": [\n        {"value": 500}\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,c.jsx)(n.h5,{id:"\u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435-sum-avg-min-max-c-group_by",children:"\u0412\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 SUM, AVG, MIN, MAX c group_by"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u0417\u0430\u043f\u0440\u043e\u0441:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:'{\n  "query": {\n    "from": "2000-01-01T00:00:00Z",\n    "to": "2077-01-01T00:00:00Z",\n    "query": "*"\n  },\n  "aggs": [\n    {\n      "field": "latency",\n      "func": "AGG_FUNC_SUM",\n      "group_by": "service"\n    },\n    {\n      "field": "latency",\n      "func": "AGG_FUNC_AVG",\n      "group_by": "service"\n    },\n    {\n      "field": "latency",\n      "func": "AGG_FUNC_MIN",\n      "group_by": "service"\n    },\n    {\n      "field": "latency",\n      "func": "AGG_FUNC_MAX",\n      "group_by": "service"\n    }\n  ]\n} | grpcurl -plaintext -d @ localhost:9004 seqproxyapi.v1.SeqProxyApi/GetAggregation\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u041e\u0442\u0432\u0435\u0442:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "aggs": [\n    {\n      "buckets": [\n        {"key": "svc2", "value": 600},\n        {"key": "svc3", "value": 500},\n        {"key": "svc1", "value": 400}\n      ]\n    },\n    {\n      "buckets": [\n        {"key": "svc3", "value": 500},\n        {"key": "svc2", "value": 300},\n        {"key": "svc1", "value": 200}\n      ]\n    },\n    {\n      "buckets": [\n        {"key": "svc1", "value": 100},\n        {"key": "svc2", "value": 200},\n        {"key": "svc3", "value": 500}\n      ]\n    },\n    {\n      "buckets": [\n        {"key": "svc3", "value": 500},\n        {"key": "svc2", "value": 400},\n        {"key": "svc1", "value": 300}\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,c.jsx)(n.h5,{id:"quantile",children:"QUANTILE"}),"\n",(0,c.jsxs)(n.blockquote,{children:["\n",(0,c.jsx)(n.p,{children:"\u0424\u0443\u043d\u043a\u0446\u0438\u044e \u0430\u0433\u0440\u0435\u0433\u0430\u0446\u0438\u0438 QUANTILE \u0442\u0430\u043a\u0436\u0435 \u043c\u043e\u0436\u043d\u043e \u043f\u0440\u0438\u043c\u0435\u043d\u044f\u0442\u044c \u0441 \u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u043a\u043e\u0439 \u043f\u043e \u043f\u043e\u043b\u044e,\n\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044f \u043f\u043e\u043b\u0435 group_by."}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u0417\u0430\u043f\u0440\u043e\u0441:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:'{\n  "query": {\n    "from": "2000-01-01T00:00:00Z",\n    "to": "2077-01-01T00:00:00Z",\n    "query": "*"\n  },\n  "aggs": [\n    {\n      "field": "latency",\n      "func": "AGG_FUNC_QUANTILE",\n      "quantiles": [\n        0.5,\n        0.9\n      ]\n    }\n  ]\n} | grpcurl -plaintext -d @ localhost:9004 seqproxyapi.v1.SeqProxyApi/GetAggregation\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u041e\u0442\u0432\u0435\u0442:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "aggs": [\n    {\n      "buckets": [\n        {\n          "quantiles": [\n            300,\n            500\n          ],\n          "value": 300\n        }\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,c.jsx)(n.h5,{id:"unique-count",children:"UNIQUE, COUNT"}),"\n",(0,c.jsxs)(n.blockquote,{children:["\n",(0,c.jsxs)(n.p,{children:["\u0414\u043b\u044f ",(0,c.jsx)(n.code,{children:"AGG_FUNC_UNIQUE"}),", ",(0,c.jsx)(n.code,{children:"AGG_FUNC_COUNT"})," \u043f\u043e\u043b\u0435 ",(0,c.jsx)(n.code,{children:"field"})," \u043d\u0435 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f."]}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u0417\u0430\u043f\u0440\u043e\u0441:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:'{\n  "query": {\n    "from": "2000-01-01T00:00:00Z",\n    "to": "2077-01-01T00:00:00Z",\n    "query": "*"\n  },\n  "aggs": [\n    {\n      "func": "AGG_FUNC_UNIQUE",\n      "group_by": "service"\n    },\n    {\n      "func": "AGG_FUNC_COUNT",\n      "group_by": "service"\n    }\n  ]\n} | grpcurl -plaintext -d @ localhost:9004 seqproxyapi.v1.SeqProxyApi/GetAggregation\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u041e\u0442\u0432\u0435\u0442:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "aggs": [\n    {\n      "buckets": [\n        {"key": "svc1"},\n        {"key": "svc2"},\n        {"key": "svc3"}\n      ]\n    },\n    {\n      "buckets": [\n        {"key": "svc1", "value": 2},\n        {"key": "svc2", "value": 2},\n        {"key": "svc3", "value": 1}\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"gethistogram",children:(0,c.jsx)(n.code,{children:"/GetHistogram"})}),"\n",(0,c.jsx)(n.p,{children:"Method of getting histograms by query"}),"\n",(0,c.jsx)(n.p,{children:"Example request:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'grpcurl -plaintext -d \'\n{\n  "query": {\n    "from": "2020-01-01T00:00:00Z",\n    "to": "2030-01-01T00:00:00Z"\n  },\n  "hist": {\n    "interval": "1ms"\n  }\n}\' localhost:9004 seqproxyapi.v1.SeqProxyApi/GetHistogram\n'})}),"\n",(0,c.jsx)(n.p,{children:"Example successful response"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "hist": {\n    "buckets": [\n      {\n        "docCount": "1",\n        "ts": "2024-12-23T18:00:36.357Z"\n      },\n      {\n        "docCount": "9",\n        "ts": "2024-12-23T18:23:41.349Z"\n      }\n    ]\n  },\n  "error": {\n    "code": "ERROR_CODE_NO"\n  }\n}\n\n'})}),"\n",(0,c.jsx)(n.h3,{id:"complexsearch",children:(0,c.jsx)(n.code,{children:"/ComplexSearch"})}),"\n",(0,c.jsxs)(n.p,{children:["Search request combining fetch of ",(0,c.jsx)(n.a,{href:"#search",children:"documents"}),", ",(0,c.jsx)(n.a,{href:"#getaggregation",children:"aggregations"}),"\nand ",(0,c.jsx)(n.a,{href:"#gethistogram",children:"histograms"})]}),"\n",(0,c.jsx)(n.p,{children:"Example request:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'grpcurl -plaintext -d \'\n{\n  "query": {\n    "from": "2020-01-01T00:00:00Z",\n    "to": "2030-01-01T00:00:00Z",\n    "query": "k8s_pod:seq-proxy"\n  },\n  "with_total": true,\n  "aggs": [\n    {\n      "group_by": "k8s_pod",\n      "field": "request_time",\n      "func": "AGG_FUNC_QUANTILE",\n      "quantiles": [\n        0.2,\n        0.8,\n        0.95\n      ]\n    }\n  ],\n  "hist": {\n    "interval": "1ms"\n  },\n  "order": 0\n}\' localhost:9004 seqproxyapi.v1.SeqProxyApi/ComplexSearch\n'})}),"\n",(0,c.jsx)(n.p,{children:"Example successful response:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "total": "5",\n  "aggs": [\n    {\n      "buckets": [\n        {\n          "docCount": "6",\n          "key": "seq-proxy",\n          "value": 6,\n          "quantiles": [\n            6,\n            8,\n            9\n          ]\n        }\n      ]\n    }\n  ],\n  "hist": {\n    "buckets": [\n      {\n        "docCount": "1",\n        "ts": "2024-12-23T18:00:36.357Z"\n      },\n      {\n        "docCount": "4",\n        "ts": "2024-12-23T18:23:41.349Z"\n      }\n    ]\n  },\n  "error": {\n    "code": "ERROR_CODE_NO"\n  }\n}\n'})}),"\n",(0,c.jsx)(n.h3,{id:"fetch",children:(0,c.jsx)(n.code,{children:"/Fetch"})}),"\n",(0,c.jsx)(n.p,{children:"Method returning stream of documents by passed seq-id's"}),"\n",(0,c.jsx)(n.p,{children:"Example request:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'grpcurl -plaintext -d \'\n{\n  "ids": [\n    "25b5c2f493010000-59024b2ba3fb9630",\n    "0593adf493010000-5902ee007dfb6547"\n  ]\n}\' localhost:9004 seqproxyapi.v1.SeqProxyApi/Fetch\n'})}),"\n",(0,c.jsx)(n.p,{children:"Example successful response:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",metastring:"lines",children:'{\n  "id": "25b5c2f493010000-59024b2ba3fb9630",\n  "data": "eyJrOHNfcG9kIjoic2VxLWRiIiwgInJlcXVlc3RfdGltZSI6ICIxMCJ9",\n  "time": "2024-12-23T18:23:41.349Z"\n}\n{\n  "id": "0593adf493010000-5902ee007dfb6547",\n  "data": "eyJrOHNfcG9kIjoic2VxLXByb3h5IiwgInJlcXVlc3RfdGltZSI6ICI1IiwgInRpbWUiOiAiMjAyNC0xMi0yM1QxODowMDozNi4zNTdaIn0=",\n  "time": "2024-12-23T18:00:36.357Z"\n}\n'})}),"\n",(0,c.jsx)(n.h4,{id:"mapping",children:(0,c.jsx)(n.code,{children:"/Mapping"})}),"\n",(0,c.jsx)(n.p,{children:"Method returning mapping seq-db working with"}),"\n",(0,c.jsx)(n.p,{children:"Example request:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"grpcurl -plaintext localhost:9004 seqproxyapi.v1.SeqProxyApi/Mapping\n"})}),"\n",(0,c.jsx)(n.p,{children:"Example successful response:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "data": "eyJrOHNfY29udGFpbmVyIjoia2V5d29yZCIsIms4c19uYW1lc3BhY2UiOiJrZXl3b3JkIiwiazhzX3BvZCI6ImtleXdvcmQiLCJtZXNzYWdlIjoidGV4dCIsIm1lc3NhZ2Uua2V5d29yZCI6ImtleXdvcmQiLCJyZXF1ZXN0IjoidGV4dCIsInJlcXVlc3RfdGltZSI6ImtleXdvcmQiLCJyZXF1ZXN0X3VyaSI6InBhdGgiLCJzb21lb2JqIjoib2JqZWN0Iiwic29tZW9iai5uZXN0ZWQiOiJrZXl3b3JkIiwic29tZW9iai5uZXN0ZWR0ZXh0IjoidGV4dCJ9"\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"decoding base64 results in:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "k8s_container": "keyword",\n  "k8s_namespace": "keyword",\n  "k8s_pod": "keyword",\n  "message": "text",\n  "message.keyword": "keyword",\n  "request": "text",\n  "request_time": "keyword",\n  "request_uri": "path",\n  "someobj": "object",\n  "someobj.nested": "keyword",\n  "someobj.nestedtext": "text"\n}\n'})}),"\n",(0,c.jsx)(n.h4,{id:"status",children:(0,c.jsx)(n.code,{children:"/Status"})}),"\n",(0,c.jsx)(n.p,{children:"Method returning detailed information about seq-db stores seq-db proxy working with"}),"\n",(0,c.jsx)(n.p,{children:"Example request:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"grpcurl -plaintext localhost:9004 seqproxyapi.v1.SeqProxyApi/Status\n"})}),"\n",(0,c.jsx)(n.p,{children:"Example successful response"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",children:'{\n  "numberOfStores": 1,\n  "oldestStorageTime": "2024-12-23T18:23:37.622Z",\n  "stores": [\n    {\n      "host": "localhost:9234",\n      "values": {\n        "oldestTime": "2024-12-23T18:23:37.622Z"\n      }\n    }\n  ]\n}\n'})}),"\n",(0,c.jsx)(n.h4,{id:"export",children:(0,c.jsx)(n.code,{children:"/Export"})}),"\n",(0,c.jsxs)(n.p,{children:["Same method as a ",(0,c.jsx)(n.a,{href:"#search",children:(0,c.jsx)(n.code,{children:"/Search"})}),", but streaming"]}),"\n",(0,c.jsx)(n.p,{children:"Example request:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'grpcurl -plaintext -d \'\n{\n  "query": {\n    "from": "2020-01-01T00:00:00Z",\n    "to": "2030-01-01T00:00:00Z",\n    "query": "k8s_pod:seq-db"\n  },\n  "size": 2,\n}\' localhost:9004 seqproxyapi.v1.SeqProxyApi/Export\n'})}),"\n",(0,c.jsx)(n.p,{children:"Example successful response:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-json",metastring:"lines",children:'{\n  "doc": {\n    "id": "25b5c2f493010000-5902919c44e568be",\n    "data": "eyJrOHNfcG9kIjoic2VxLWRiIiwgInJlcXVlc3RfdGltZSI6ICIxMyJ9",\n    "time": "2024-12-23T18:23:41.349Z"\n  }\n}\n{\n  "doc": {\n    "id": "25b5c2f493010000-5902d3ff804c179d",\n    "data": "eyJrOHNfcG9kIjoic2VxLWRiIiwgInJlcXVlc3RfdGltZSI6ICIxMiJ9",\n    "time": "2024-12-23T18:23:41.349Z"\n  }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>d});var r=s(6540);const c={},l=r.createContext(c);function i(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:i(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);